#from redpanda-kafka-playground import send_to_redpanda
from client import encrypt_frame, random_bit_flip_attack
from server import decode_frame


if __name__ == "__main__":
    fake_frame = bytes([
        137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,
        0,0,2,0,0,0,1,44,8,6,0,0,0,123,45,154,34,
        0,0,0,9,112,72,89,115,0,0,11,19,0,0,11,19,
        1,0,154,156,24,0,0,0,7,116,73,77,69,7,230,
        2,28,18,40,54,19,100,122,29,0,0,2,0,73,68,65,
        84,120,156,237,221,189,114,27,199,181,254,239,
        87,64,96,24,6,33,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130,
        48,12,67,16,130,48,12,67,16,130,48,12,67,16,130
    ])

    e = encrypt_frame(fake_frame)
#    print(f"Combined Payload (to kafka): {e}")
    flips=600
    print(f"Attacking with {flips} number of bit flips...")
    e = random_bit_flip_attack(e, flips=flips)
    r = decode_frame(e)
#    print(f"Decoded payload (from kafka?): {r}")

    #print(f"fake_frame: {type(fake_frame)}")
    #print(f"e: {type(e)}")
    #print(f"r: {type(r)}")
    #print(f"e==r : {e==r}")
    #print(f"fake==e : {fake_frame == e}")
    #print(f"fake==r : {fake_frame == r}")
